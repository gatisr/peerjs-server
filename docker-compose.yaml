services:
  peerjs:
    build: .
    container_name: server
    ports:
      - "${PORT:-9000}:9000"
    environment:
      - PORT=9000
      - PEERJS_PATH=${PEERJS_PATH:-/peerjs}
      - KEY=${KEY:-peerjs}
      - EXPIRE_TIMEOUT=${EXPIRE_TIMEOUT:-5000}
      - ALIVE_TIMEOUT=${ALIVE_TIMEOUT:-60000}
      - CONCURRENT_LIMIT=${CONCURRENT_LIMIT:-5000}
      - ALLOW_DISCOVERY=${ALLOW_DISCOVERY:-true}
      - CORS_ORIGINS=${CORS_ORIGINS:-*}
      - USE_CREDENTIALS=${USE_CREDENTIALS:-false}
      - VERIFY_WS_ORIGIN=${VERIFY_WS_ORIGIN:-true}
      - PROXIED=${PROXIED:-false}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENABLE_RATE_LIMIT=${ENABLE_RATE_LIMIT:-false}
      - MAX_CONNECTIONS_PER_IP=${MAX_CONNECTIONS_PER_IP:-50}
      - CONNECTION_TIMEOUT=${CONNECTION_TIMEOUT:-300000}
      
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:9000/peerjs"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
      
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
